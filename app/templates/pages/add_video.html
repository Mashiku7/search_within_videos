{% extends "common/page_base.html" %}

{% block content %}

<h1>Add a Video</h1>

<form id="addvideo" action="/add_video" method="POST" enctype="">

	<input id="urlbox" type="text" name="url">
	<input type="submit" value="Process">

</form>


<div class="progress" style="width: 50%; margin: 50px;">
    <div class="progress-bar progress-bar-striped active"  role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
</div>

<script>

function subscribeToProgress() {
	console.log("subscribing");
	var source = new EventSource("/progress");
	source.onmessage = function(event) {
		console.log(event.data);
	    $('.progress-bar').css('width', event.data+'%').attr('aria-valuenow', event.data);   
	}
}

var form = $("#addvideo");
form.submit(function(e) {
	e.preventDefault();
	$.ajax({
		type: form.attr("method"),
		url: form.attr("action"),
		data: form.serialize(),
		success: function(data) {
			subscribeToProgress();
			console.log(data);
		}
	});
});

</script>

{% endblock %}